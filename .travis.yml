language: python
python:
  - '3.8'
  - '3.7'
  - '3.6'
  - '3.5'
services:
  - redis-server
  - mysql
env:
  - FLASK_ENV=dev
before_install:
  - echo "USE mysql;\nUPDATE user SET password=PASSWORD('123456') WHERE user='root';\nFLUSH PRIVILEGES;\n" | mysql -u root
  - mysql -e 'CREATE DATABASE IF NOT EXISTS `mobile_device_borrowing` default character SET utf8mb4 ;'
  - mysql -u root -p123456 < backend/mysql/docker-entrypoint-initdb.d/02_table_structure.sql
  - cd backend/src
install:
  - pip install -r requirements.txt
script:
  - nohup python manage.py runserver &
  - pytest test  -sv